{% load staticfiles %}
<html ng-app="grociousApp">
<head>
  <title>Main Page</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js"></script>
  <link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet"/>
  <script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>
  <style>
  .table tbody>tr>td.vert-align {
    vertical-align: middle;
  }
  .brand-name {
    margin-left: 2px;
    padding-left: 2px;
    border-left: 2px;
  }
  </style>
</head>
<body role="document">
  <nav class="navbar navbar-inverse">
    <div class="container container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="#"><img alt="Brand" width="25" height="25" class="pull-left brand-icon" src="{% static 'carrito-best-md.png' %}" /><span class="brand-name">Grocious</span></a>
      </div>
      <div>
        <ul class="nav navbar-nav">
          <li class="active"><a href="/main/"><span class="glyphicon glyphicon-home"></span> Home</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="/myCart/" data-toggle="modal" data-target="#modal"><span class="glyphicon glyphicon-shopping-cart"></span> Cart</a></li>
          <li><a href="/logout/"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
        </ul>
        <p class="navbar-text navbar-right">Signed in as <a href="/myInfo/" class="navbar-link" data-toggle="modal" data-target="#modal2">{{uname}}</a></p>
      </div>
    </div>
  </nav>
  <div class="container container-fluid" ng-controller="StoreCtrl as store" data-ng-init="store.search(store.default);">
    <!--div class="col-sm-3 col-md-2 sidebar">
      <ul class="nav nav-sidebar nav-pills nav-stacked" role="menu">
        <li class="dropdown-submenu"><a href="#" tabindex="-1">Raw Material</a>
            <ul class="dropdown-menu">
              {% for element in rawMaterial %}
                <li><a href="#">{{element}}</a></li>
              {% endfor %}
            </ul>
        </li>
        <li><a href="#">Ready Steady Go</a></li>
        <li><a href="#">Desserts</a></li>
        <li><a href="#">Dare &amp; Care</a></li>
      </ul>
    </div-->
    <!--div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-0 main"-->
      <div class="row">
        <div class="col-lg-6">
          <div class="input-group">
            <input type="text" class="form-control" placeholder="Search for..." ng-model="store.query">
            <span class="input-group-btn">
              <button class="btn btn-default" type="button" ng-model="store.default" ng-click="store.search(store.default);$event.preventDefault();">Go!</button>
            </span>
          </div><!-- /input-group -->
        </div><!-- /.col-lg-6 -->
      </div><br />
      <div class="row">
        {% if message %}
        <div class="alert alert-info alert-dismissible" id="message" role="alert">
          <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <strong>{{message}}</strong>
        </div>
        {% endif %}
        <div class="col-sm-3 col-md-3" ng-repeat="product in store.products">
          <div class="thumbnail">
            <img data-src="holder.js/100%x100" alt="100%x100" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMjQyIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDI0MiAyMDAiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiPjxkZWZzLz48cmVjdCB3aWR0aD0iMjQyIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI0VFRUVFRSIvPjxnPjx0ZXh0IHg9IjkyLjQ1MzEyNSIgeT0iMTAwIiBzdHlsZT0iZmlsbDojQUFBQUFBO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1mYW1pbHk6QXJpYWwsIEhlbHZldGljYSwgT3BlbiBTYW5zLCBzYW5zLXNlcmlmLCBtb25vc3BhY2U7Zm9udC1zaXplOjExcHQ7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+MjQyeDIwMDwvdGV4dD48L2c+PC9zdmc+" data-holder-rendered="true" style="height: 130px; width: 100%; display: block;">
            <div class="caption">
              {% verbatim %}
              <h5>{{product.name}}</h5>
              <h5>{{product.quantity}} {{product.unit}} for <b>${{product.price | number:2 }}</b> </h5>
              <p> {{product.desc | limitTo:25}} </p>
              <p>
                <input type="number" name="quantity"  min="1" max="10" ng-model="product.totalQuantity" ng-init="product.totalQuantity=1"/>
                <a ng-href="/cart/add/{{product._id.$oid}}/{{product.totalQuantity}}" class="btn btn-primary" role="button">Add to Cart</a>
              </p>
              {% endverbatim %}
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12 text-center pagination">
          <div class="btn-group" role="group" aria-label="Default button group">
            <button type="button" class="btn btn-default" aria-label="Previous" id="prev" ng-disabled="store.notPrev" ng-model="store.prev" ng-click="store.search(store.prev);$event.preventDefault();">«Previous</button>
          </div>
          <div class="btn-group" role="group" aria-label="Default button group">
            <button type="button" class="btn btn-default" aria-label="Next" id="next" ng-disabled="store.notNext" ng-model="store.next" ng-click="store.search(store.next);$event.preventDefault();">Next»</button>
          </div>
        </div>
      </div>
    </div>
  <!--/div-->
  <div class="container-fluid">
    <div class="row">
      <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
          </div><!-- /.modal-content -->
        </div>
      </div>
      <div class="modal fade" id="modal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
          </div><!-- /.modal-content -->
        </div>
      </div>
    </div>
  </div>
  <footer class="footer">
    <div class="container">
      <p class="text-muted">Copyright Grocious</p>
    </div>
  </footer>
  <script type="text/javascript">
  (function(){
    var app = angular.module('grociousApp', []);
    app.controller('StoreCtrl', [ '$http','$log', function ($http, $location, $log) {
      var store = this;
      this.products =  [];
      this.default = 1
      this.prev = -1
      this.next = -1
      this.notNext = true
      this.notPrev = true
      this.query = "biscuit";
      this.search = function($page) {

        $http.get('/search?query=' + store.query + "&p=" + $page).success(function(data) {
          console.log(data)
          store.products = angular.fromJson(data.products);
          if (typeof data.next !== 'undefined') {
            store.next = data.next;
            store.notNext = false;
          } else {
            store.notNext = true;
          }
          if (typeof data.prev !== 'undefined') {
            store.prev = data.prev;
            store.notPrev = false;
          } else {
            store.notPrev = true;
          }
        });
      };

      this.add = function(href, count) {
        href = href + "/" + count;
        $http.get(href).success(function(data) {
          alert(data.message);
        });
      };

      this.getLink = function(id) {
        return "/cart/add/" + id;
      };

    }]);
  })();

  $(document).ready(function(){
    $('body').on('hidden.bs.modal', '.modal', function () {
      $(this).removeData('bs.modal');
    });

    /*$("a[data-toggle=modal]").click(function() {
    var target, url;
    target = $(this).attr('data-target');
    url = $(this).attr('href');
    return $(target).load(url);
    })*/
  });
  </script>
</body>
</html>
